@if (isVisible) {
<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-panel" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ "questModal.HEADER_ADD" | translate }}</h3>
      <button class="icon-btn" (click)="closeModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="modal-content">
      <div class="main-fields">
        @for (col of formColumns; track col.key) {
        <div class="form-group">
          <!-- Dodano pipe translate, aby col.header mógł być kluczem -->
          <label [for]="'create-' + col.key">{{
            col.header | translate
          }}</label>
          @if (col.type === 'checkbox') {
          <input
            type="checkbox"
            [id]="'create-' + col.key"
            [(ngModel)]="newItem[col.key]"
            class="styled-checkbox"
          />
          } @else if (col.type === 'select') {
          <select
            [id]="'create-' + col.key"
            [(ngModel)]="newItem[col.key]"
            class="form-control"
          >
            @for (opt of col.options; track opt.value) {
            <!-- Dodano pipe translate dla opcji -->
            <option [value]="opt.value">{{ opt.label | translate }}</option>
            }
          </select>
          } @else {
          <input
            [type]="col.type === 'number' ? 'number' : 'text'"
            [id]="'create-' + col.key"
            [(ngModel)]="newItem[col.key]"
            class="form-control"
            autocomplete="off"
          />
          }
        </div>
        }
      </div>

      @if (objectives) {
      <div class="objectives-section">
        <div class="section-header">
          <h4>{{ "questModal.OBJECTIVES_HEADER" | translate }}</h4>
          <button class="btn-add-small" (click)="addObjective()">
            <mat-icon>add</mat-icon>
            {{ "questModal.BTN_ADD_OBJECTIVE" | translate }}
          </button>
        </div>

        @if (newItem.objectives.length === 0) {
        <p style="color: var(--muted); text-align: center; font-size: 0.9rem">
          {{ "questModal.NO_OBJECTIVES_MSG" | translate }}
        </p>
        } @for (obj of newItem.objectives; track $index) {
        <div class="objective-card">
          <button class="btn-delete" (click)="removeObjective($index)">
            <mat-icon>delete</mat-icon>
          </button>

          <div class="obj-desc-row">
            <input
              type="text"
              [(ngModel)]="obj.description"
              [placeholder]="'questModal.PLACEHOLDER_DESC' | translate"
              class="form-control"
            />
          </div>

          <div class="obj-grid-row">
            <select [(ngModel)]="obj.type" class="form-control">
              @for(type of objectiveTypes; track type.value) {
              <option [value]="type.value">{{ type.label | translate }}</option>
              }
            </select>

            <input
              type="text"
              [(ngModel)]="obj.target"
              [placeholder]="'questModal.PLACEHOLDER_TARGET' | translate"
              class="form-control"
            />

            <input
              type="number"
              [(ngModel)]="obj.goalCount"
              [placeholder]="'questModal.PLACEHOLDER_AMOUNT' | translate"
              class="form-control"
            />
          </div>

          <div class="obj-rewards-row">
            <div class="reward-field">
              <label>{{ "questModal.REWARD_WOOD" | translate }}</label>
              <input type="number" [(ngModel)]="obj.woodReward" min="0" />
            </div>
            <div class="reward-field">
              <label>{{ "questModal.REWARD_CLAY" | translate }}</label>
              <input type="number" [(ngModel)]="obj.clayReward" min="0" />
            </div>
            <div class="reward-field">
              <label>{{ "questModal.REWARD_IRON" | translate }}</label>
              <input type="number" [(ngModel)]="obj.ironReward" min="0" />
            </div>
          </div>
        </div>
        }
      </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        {{ "questModal.BTN_CANCEL" | translate }}
      </button>
      <button class="btn btn-primary" (click)="saveChanges()">
        {{ "questModal.BTN_SAVE" | translate }}
      </button>
    </div>
  </div>
</div>
}
