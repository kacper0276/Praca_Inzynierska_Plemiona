<div class="main-container">
  <h3>Dziennik Zadań</h3>

  <div class="quests-grid">
    <div
      *ngFor="let prog of userQuests"
      class="quest-card"
      [ngClass]="{
        completed: prog.isCompleted && !prog.completedAt,
        claimed: prog.isCompleted && prog.completedAt
      }"
    >
      <div class="quest-header">
        <div class="quest-main-info">
          <i class="material-icons quest-type-icon">assignment</i>
          <div class="quest-text">
            <h4>{{ prog.quest.title }}</h4>
            <p class="description">{{ prog.quest.description }}</p>
          </div>
        </div>

        <div
          class="quest-badge"
          [attr.data-status]="
            prog.completedAt
              ? 'claimed'
              : prog.isCompleted
              ? 'completed'
              : 'active'
          "
        >
          {{
            prog.completedAt
              ? "Odebrano"
              : prog.isCompleted
              ? "Do odebrania"
              : "W toku"
          }}
        </div>
      </div>

      <div class="quest-content">
        <div class="requirements-list">
          <div *ngFor="let objProg of prog.objectivesProgress" class="req-item">
            <span class="req-label">
              {{ objProg.objective.description || "Ładowanie celu..." }}
            </span>

            <span class="req-values">
              {{ objProg.currentCount }} /
              {{ objProg.objective.goalCount || "?" }}
            </span>

            <div class="mini-progress">
              <div
                class="mini-bar"
                [style.width.%]="calculateObjectiveProgress(objProg)"
                [style.background-color]="
                  objProg.isCompleted
                    ? 'var(--status-ready)'
                    : 'var(--status-active)'
                "
              ></div>
            </div>
          </div>
        </div>
      </div>

      <div class="quest-footer">
        <div class="rewards-container">
          <span class="label">Nagrody:</span>
          <div class="rewards-row">
            <div *ngIf="prog.quest.woodReward > 0" class="reward-pill">
              <img
                src="/assets/icons/wood.png"
                alt=""
                style="width: 14px; height: 14px"
              />
              {{ prog.quest.woodReward }}
            </div>
            <div *ngIf="prog.quest.clayReward > 0" class="reward-pill">
              <img
                src="/assets/icons/clay.png"
                alt="Clay icon"
                style="width: 14px; height: 14px"
              />
              {{ prog.quest.clayReward }}
            </div>
            <div *ngIf="prog.quest.ironReward > 0" class="reward-pill">
              <img
                src="/assets/icons/iron.png"
                alt="Iron icon"
                style="width: 14px; height: 14px"
              />
              {{ prog.quest.ironReward }}
            </div>
            <div *ngIf="prog.quest.populationReward > 0" class="reward-pill">
              <img
                src="/assets/icons/villager.png"
                alt="Villager icon"
                style="width: 14px; height: 14px"
              />
              {{ prog.quest.populationReward }}
            </div>
          </div>
        </div>

        <button
          *ngIf="prog.isCompleted && !prog.completedAt"
          (click)="claimReward(prog.id ?? -1)"
          class="claim-btn"
        >
          Odbierz
        </button>

        <div *ngIf="prog.completedAt" class="claimed-icon">
          <i class="material-icons">check_circle</i>
        </div>
      </div>
    </div>
  </div>
</div>
