<nav class="side-menu" [class.collapsed]="isCollapsed">
  <div class="menu-content">
    <div class="toggle-button-container">
      <button class="toggle-btn" (click)="toggleCollapse()">
        <mat-icon>{{ isCollapsed ? "menu" : "chevron_left" }}</mat-icon>
      </button>
    </div>

    <div class="side-controls">
      <div class="lang-flags">
        <button
          class="flag-btn"
          [class.active]="currentLang === 'pl'"
          (click)="setLanguage('pl')"
          [title]="'sideMenu.LANG_PL' | translate"
        >
          <img src="/assets/icons/pl-flag.png" alt="PL" />
        </button>
        <button
          class="flag-btn"
          [class.active]="currentLang === 'en'"
          (click)="setLanguage('en')"
          [title]="'sideMenu.LANG_EN' | translate"
        >
          <img src="/assets/icons/en-flag.png" alt="EN" />
        </button>
      </div>

      <div class="theme-toggle">
        <button
          class="theme-btn"
          (click)="toggleTheme()"
          [title]="
            (currentTheme === 'dark'
              ? 'sideMenu.THEME_LIGHT'
              : 'sideMenu.THEME_DARK'
            ) | translate
          "
        >
          <img
            [src]="
              '/assets/icons/' +
              (currentTheme === 'dark' ? 'moon.png' : 'sun.png')
            "
            alt="Theme Icon"
          />
        </button>
      </div>
    </div>

    <ul>
      <li
        [class.active]="activeTab === 'village'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.VILLAGE' | translate) : ''"
      >
        <a routerLink="village/kacper0276@op.pl">
          <img src="/assets/icons/village.png" alt="Village" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.VILLAGE" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'map'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.MAP' | translate) : ''"
      >
        <a routerLink="map">
          <img src="/assets/icons/map.png" alt="Map" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.MAP" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'army'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.ARMY' | translate) : ''"
      >
        <a routerLink="army">
          <img src="/assets/icons/sword.png" alt="Army" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.ARMY" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'chat'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.MESSAGES' | translate) : ''"
      >
        <a routerLink="chat">
          <img src="/assets/icons/messages.png" alt="Chat" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.MESSAGES" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'ranking'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.RANKING' | translate) : ''"
      >
        <a routerLink="ranking">
          <img src="/assets/icons/ranking.png" alt="Ranking" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.RANKING" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'clan'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.CLAN' | translate) : ''"
      >
        <a routerLink="clan">
          <img src="/assets/icons/shield.png" alt="Clan" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.CLAN" | translate
          }}</span>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'invitations'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.INVITATIONS' | translate) : ''"
      >
        <a routerLink="invitations">
          <img src="/assets/icons/invite.png" alt="Invitations" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.INVITATIONS" | translate
          }}</span>

          <ng-container *ngIf="pendingRequestsCount$ | async as count">
            <span *ngIf="count > 0" class="notification-badge">{{
              count
            }}</span>
          </ng-container>
        </a>
      </li>

      <li
        [class.active]="activeTab === 'tasks'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.TASKS' | translate) : ''"
      >
        <a routerLink="tasks">
          <img src="/assets/icons/quest.png" alt="Tasks" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.TASKS" | translate
          }}</span>
        </a>
      </li>

      <li class="report-bug">
        <a
          (click)="openBugReport()"
          [title]="'sideMenu.ITEMS.REPORT_BUG_TITLE' | translate"
        >
          <img src="/assets/icons/report_bug.png" alt="Report bug" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.REPORT_BUG" | translate
          }}</span>
        </a>
      </li>

      @if (currentUser?.role === 'admin') {
      <li
        [class.active]="activeTab === 'admin'"
        [title]="isCollapsed ? ('sideMenu.ITEMS.ADMIN_PANEL' | translate) : ''"
      >
        <a routerLink="admin-panel">
          <img src="/assets/icons/admin_panel.png" alt="Admin Panel" />
          <span *ngIf="!isCollapsed">{{
            "sideMenu.ITEMS.ADMIN_PANEL" | translate
          }}</span>
        </a>
      </li>
      }
    </ul>
  </div>

  <div class="user-profile">
    <div
      class="user-info"
      (click)="toggleUserMenu()"
      [class.collapsed]="isCollapsed"
    >
      <div class="user-avatar">
        <img
          *ngIf="currentUser?.profileImage"
          [src]="backendUrl + currentUser?.profileImage"
          alt="User Avatar"
        />
        <span *ngIf="!currentUser?.profileImage">{{ getInitials() }}</span>
      </div>
      <span *ngIf="!isCollapsed" class="user-name">{{
        currentUser?.login
      }}</span>
    </div>

    <div class="user-menu" *ngIf="userMenuOpen && !isCollapsed">
      <ul>
        <li>
          <a routerLink="profile/edit" (click)="toggleUserMenu()">
            <img src="/assets/icons/pencil.png" alt="Edit" />
            <span>{{ "sideMenu.USER_MENU.EDIT_ACCOUNT" | translate }}</span>
          </a>
        </li>
        <li>
          <a
            [routerLink]="['profile', currentUser?.email]"
            (click)="toggleUserMenu()"
          >
            <img src="/assets/icons/user_profile.png" alt="Profile View" />
            <span>{{ "sideMenu.USER_MENU.PROFILE_VIEW" | translate }}</span>
          </a>
        </li>
        <li>
          <a (click)="logout()" style="cursor: pointer">
            <img src="/assets/icons/exit.png" alt="Logout" />
            <span>{{ "sideMenu.USER_MENU.LOGOUT" | translate }}</span>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <app-bug-report
    *ngIf="bugModalOpen"
    (closed)="closeBugModal()"
    (submitted)="onBugSubmitted()"
  ></app-bug-report>
</nav>
